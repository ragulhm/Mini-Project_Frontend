<!DOCTYPE html>
<html>
<head>
    <title>EduPlanner - Processing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 
        This meta tag automatically redirects the user after 30 seconds. 
        It assumes the long-running LLM calls have finished by then.
    -->
    <meta http-equiv="refresh" content="30;url={{ url_for('quiz') }}" /> 
</head>
<body class="bg-dark text-white">
    <div class="container my-5">
        <div class="text-center mb-4">
            <h1 class="text-warning">EduPlanner Pipeline Running...</h1>
            <p class="lead">Integrating DeepSeek and OpenAI Agents for optimal planning.</p>
        </div>
        <div class="card bg-secondary text-white shadow-lg">
            <div class="card-header">
                <h4 class="mb-0">Pipeline Status Log</h4>
            </div>
            <!-- Scrollable body for the log output -->
            <div class="card-body" style="max-height: 400px; overflow-y: scroll;">
                <!-- Loop through the status_log list passed from main.py -->
                {% for log in status_log %}
                    <p class="mb-1" style="font-family: monospace;">{{ log }}</p>
                {% endfor %}
            </div>
            <div class="card-footer text-center">
                {% if finished %}
                    <!-- If the backend explicitly sets finished=True (e.g., on a fatal error) -->
                    <a href="{{ url_for('final_plan') }}" class="btn btn-success btn-lg mt-3">View Final Plan</a>
                {% else %}
                    <!-- Default state while processing is running -->
                    <div class="spinner-border text-warning" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Processing lesson plan through iterative loops...</p>
                    <p class="mt-2 text-info">You will be automatically redirected to the quiz in a few seconds.</p>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>